angular.module("app",["ionic","ngTouch","app.recommend","app.detail","app.mybeers","app.services","app.services.cardswipe"]).run(function(e,t,i){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()}),t.localStorage.getItem("Token")?i.setHeader(t.localStorage.getItem("Token")):i.userIdGrabber().then(function(e){console.log("Result from post resquest",e),t.localStorage.setItem("Token",e.data.cookie)})}).config(function(e,t){e.state("app",{url:"/app","abstract":!0,templateUrl:"app/app.html"}),t.otherwise("/app/recommend")}),angular.module("app.detail",[]).run(function(){}).config(function(e){e.state("app.detail",{url:"/detail",views:{menuContent:{templateUrl:"app/detail/detail.html"}}})}).controller("detailCtrl",function(e,t,i){e.beerDetails=i.getSelectedBeer(),e.addToMyBeers=function(){console.log("saving this to my beer",e.beerDetails),i.addToMyBeers(e.beerDetails)}}),angular.module("app.mybeers",[]).run(function(){}).config(function(e){e.state("app.mybeers",{url:"/mybeers",views:{menuContent:{templateUrl:"app/mybeers/mybeers.html"}}})}).controller("MyBeersCtrl",function(e,t){e.myBeers=t.getMyBeers(),e.passSelectedBeer=function(e){t.passSelectedBeer(e)}}),angular.module("app.recommend",[]).run(function(){}).config(function(e){e.state("app.recommend",{url:"/recommend",views:{menuContent:{templateUrl:"app/recommend/recommend.html"}}})}).controller("CardsCtrl",function(e,t,i,n){t.cards=n.beerRecQueue,t.addCard=function(e){t.cards.push(e)},t.cardSwiped=function(){},t.passSelectedBeer=function(e){n.passSelectedBeer(e)},t.cardDestroyed=function(i){var r;this.swipeCard.positive===!0?(n.addToQueue(t.cards[i]),r=1,n.addToMyBeers(t.cards[i])):r=-1;var o=t.cards[i],a={beer_id:o.beer_id,beer_rating:r,user_id:e.localStorage.getItem("Token")};n.sendRating(a).then(function(e){t.addCard(e.data)}).catch(function(e){console.log(e)}),t.cards.splice(i,1)}})(function(e){for(var t=document.createElement("div"),i=["webkitTransformOrigin","transform-origin","-webkit-transform-origin","webkit-transform-origin","-moz-transform-origin","moz-transform-origin","MozTransformOrigin","mozTransformOrigin"],n="webkitTransformOrigin",r=0;r<i.length;r++)if(void 0!==t.style[i[r]]){n=i[r];break}for(var o=["webkitTransition","transition","-webkit-transition","webkit-transition","-moz-transition","moz-transition","MozTransition","mozTransition"],a="webkitTransition",r=0;r<o.length;r++)if(void 0!==t.style[o[r]]){a=o[r];break}var s=e.controllers.ViewController.inherit({initialize:function(e){this.cards=[];window.innerWidth/window.innerHeight;this.maxWidth=window.innerWidth-(e.cardGutterWidth||0),this.maxHeight=e.height||300,this.cardGutterWidth=e.cardGutterWidth||10,this.cardPopInDuration=e.cardPopInDuration||400,this.cardAnimation=e.cardAnimation||"pop-in"},pushCard:function(e){var t=this;this.cards.push(e),this.beforeCardShow(e),e.transitionIn(this.cardAnimation),setTimeout(function(){e.disableTransition(t.cardAnimation)},this.cardPopInDuration+100)},beforeCardShow:function(){var e=this.cards[this.cards.length-1];if(e){{window.innerHeight/2-this.maxHeight/2}console.log(window.innerHeight,this.maxHeight);{5*Math.min(this.cards.length,3)}e.setPopInDuration(this.cardPopInDuration),e.setZIndex(this.cards.length)}},popCard:function(e){var t=this.cards.shift();return e&&t.swipe(),t}}),c=e.views.View.inherit({initialize:function(t){t=e.extend({},t),e.extend(this,t),this.el=t.el,this.startX=this.startY=this.x=this.y=0,this.bindEvents()},setX:function(t){this.el.style[e.CSS.TRANSFORM]="translate3d("+t+"px,"+this.y+"px, 0)",this.x=t,this.startX=t},setY:function(t){this.el.style[e.CSS.TRANSFORM]="translate3d("+this.x+"px,"+t+"px, 0)",this.y=t,this.startY=t},setZIndex:function(e){this.el.style.zIndex=e},setWidth:function(e){this.el.style.width=e+"px"},setHeight:function(e){this.el.style.height=e+"px"},setPopInDuration:function(e){this.cardPopInDuration=e},transitionIn:function(e){var t=this;this.el.classList.add(e+"-start"),this.el.classList.add(e),this.el.style.display="block",setTimeout(function(){t.el.classList.remove(e+"-start")},100)},disableTransition:function(e){this.el.classList.remove(e)},swipe:function(e){this.transitionOut(e)},transitionOut:function(t){var i=this;if(t===!0||this.x>0){var n=this.rotationAngle+.6*this.rotationDirection||Math.random()*-.4,r=this.rotationAngle?.2:.5;this.el.style[a]="-webkit-transform "+r+"s ease-in-out",this.el.style[e.CSS.TRANSFORM]="translate3d("+1.5*window.innerWidth+"px,"+this.y+"px, 0) rotate("+n+"rad)",this.onSwipe&&this.onSwipe(),i.positive=!0,setTimeout(function(){i.onDestroy&&i.onDestroy(!0)},1e3*r)}else{var n=this.rotationAngle+.6*this.rotationDirection||.4*Math.random(),r=this.rotationAngle?.2:.5;this.el.style[a]="-webkit-transform "+r+"s ease-in-out",this.el.style[e.CSS.TRANSFORM]="translate3d("+-1.5*window.innerWidth+"px,"+this.y+"px, 0) rotate("+n+"rad)",this.onSwipe&&this.onSwipe(),i.positive=!1,setTimeout(function(){i.onDestroy&&i.onDestroy()},1e3*r)}},dragThreshold:0,bindEvents:function(){var t=this;e.onGesture("dragstart",function(e){var i=window.innerWidth/2;e.gesture.touches[0].pageX<i?t._transformOriginRight():t._transformOriginLeft(),window._rAF(function(){t._doDragStart(e)})},this.el),e.onGesture("drag",function(e){window._rAF(function(){t._doDrag(e)})},this.el),e.onGesture("dragend",function(e){window._rAF(function(){t._doDragEnd(e)})},this.el)},_transformOriginLeft:function(){this.el.style[n]="left center",this.rotationDirection=1},_transformOriginRight:function(){this.el.style[n]="right center",this.rotationDirection=-1},_doDragStart:function(e){var t=this.el.offsetWidth,i=window.innerWidth/2+this.rotationDirection*(t/2),n=Math.abs(i-e.gesture.touches[0].pageY);console.log(n),this.touchDistance=10*n,console.log("Touch distance",this.touchDistance)},_doDrag:function(t){var i=t.gesture.deltaX/3;dragThreshold=Math.abs(i),dragThreshold>20&&(this.rotationAngle=Math.atan(i/this.touchDistance)*this.rotationDirection,t.gesture.deltaX<0&&(this.rotationAngle=0),this.x=this.startX+.4*t.gesture.deltaX,this.el.style[e.CSS.TRANSFORM]="translate3d("+this.x+"px, "+this.y+"px, 0) rotate("+(this.rotationAngle||0)+"rad)")},_doDragEnd:function(e){console.log("drag dist",dragThreshold),dragThreshold>20&&(console.log("drag dist",dragThreshold),this.transitionOut(e))}});angular.module("app.services.cardswipe",["ionic"]).directive("swipeCard",["$timeout",function(e){return{restrict:"E",template:'<div class="swipe-card" ng-transclude></div>',require:"^swipeCards",replace:!0,transclude:!0,scope:{onSwipe:"&",onDestroy:"&"},compile:function(){return function(t,i,n,r){var o=i[0],a=new c({el:o,onSwipe:function(){e(function(){t.onSwipe()})},onDestroy:function(){e(function(){t.onDestroy(),i.remove()})}});t.$parent.swipeCard=a,r.pushCard(a)}}}}]).directive("swipeCards",["$rootScope",function(e){return{restrict:"E",template:'<div class="swipe-cards" ng-transclude></div>',replace:!0,transclude:!0,scope:{},controller:function(){var t=new s({});return e.$on("swipeCard.pop",function(e){t.popCard(e)}),t}}}]).factory("$ionicSwipeCardDelegate",["$rootScope",function(e){return{popCard:function(t,i){e.$emit("swipeCard.pop",i)},getSwipebleCard:function(e){return e.$parent.swipeCard}}}])})(window.ionic),angular.module("app.services",[]).factory("BeerFactory",function(e,t){var i=[{beer_id:104,beer_name:"Samuel Adams Boston Lager",beer_image_url:"./img/samadams.jpg"},{beer_id:754,beer_name:"Guinness Draught",beer_image_url:"./img/guinness.jpg"},{beer_id:355,beer_name:"Dead Guy Ale",beer_image_url:"./img/deadguy.jpg"},{beer_id:1904,beer_name:"Sierra Nevada Celebration Ale",beer_image_url:"./img/sierranevada.jpg"},{beer_id:680,beer_name:"Brooklyn Black Chocolate Stout",beer_image_url:"./img/blackchocolate.jpg"},{beer_id:1212,beer_name:"Blue Moon Belgian White",beer_image_url:"./img/bluemoon.jpg"}],n=function(t){return e({method:"GET",url:"http://next-beer.herokuapp.com/api/v1/"+t.beer_id}).success(function(e){console.log("Success",e)})},r=function(e){i.push(e)},o=function(e){var i=JSON.parse(t.localStorage.getItem("myBeers"))||{};i[e.beer_name]=e,t.localStorage.setItem("myBeers",JSON.stringify(i))},a=function(){return JSON.parse(t.localStorage.getItem("myBeers"))},s=function(){return selectedBeer},c=function(e){selectedBeer=i[e]};return{beerRecQueue:i,addToQueue:r,addToMyBeers:o,getMyBeers:a,sendRating:n,getSelectedBeer:s,passSelectedBeer:c}}).factory("UserFactory",function(e){var t=function(){return e({method:"GET",url:"http://next-beer.herokuapp.com/api/v2/user",sucess:function(e){console.log("Success!",e)},error:function(e){console.log("Error!",e)}})},i=function(t){e.defaults.headers.common.Authorization="Bearer"+t};return{userIdGrabber:t,setHeader:i}});