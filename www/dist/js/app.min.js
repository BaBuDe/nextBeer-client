angular.module("app",["ionic","app.recommend","app.detail","app.mybeers","app.services"]).run(["$ionicPlatform","$window","UserFactory",function(e,t,i){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()}),i.enableToken()}]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("app",{url:"/app","abstract":!0,templateUrl:"app/app.html"}),t.otherwise("/app/recommend")}]),angular.module("app.detail",[]).run(function(){console.log("hey!!")}).config(["$stateProvider",function(e){e.state("app.detail",{url:"/detail",views:{menuContent:{templateUrl:"app/detail/detail.html"}}})}]).controller("detailCtrl",["$scope","BeerFactory",function(e,t){console.log("dragon ball!!"),e.beerDetails=t.getSelectedBeer(),e.addToMyBeers=function(){console.log("saving this to my beer",e.beerDetails),t.addToMyBeers(e.beerDetails)}}]),angular.module("app.mybeers",[]).run(function(){}).config(["$stateProvider",function(e){e.state("app.mybeers",{url:"/mybeers",views:{menuContent:{templateUrl:"app/mybeers/mybeers.html"}}})}]).controller("MyBeersCtrl",["$scope","BeerFactory",function(e,t){e.myBeers=t.getMyBeers(),e.passSelectedBeer=function(e){console.log(e),t.passSelectedBeer(e)}}]),angular.module("app.recommend",["app.recommend.swipe"]).run(function(){}).config(["$stateProvider",function(e){e.state("app.recommend",{url:"/recommend",views:{menuContent:{templateUrl:"app/recommend/recommend.html"}}})}]).controller("CardsCtrl",["$window","$scope","BeerFactory",function(e,t,i){t.beers=i.beerRecQueue;var r=0,n=function(e){var i=e.data;t.beers.push(i)};t.cardSwiped=function(e){this.swipeCard&&this.swipeCard.positive?(r=1,i.addToMyBeers(t.beers[e])):r=-1;var o=t.beers[e],a={beer_id:o.beer_id,beer_rating:r};i.sendRating(a).then(n).catch(function(e){console.log(e)})},t.cardDestroyed=function(e){t.beers.splice(e,1)},t.passSelectedBeer=function(e){i.passSelectedBeer(e)}}]),function(){var e,t={baseUrl:"http://next-beer.herokuapp.com/api/v2"},i=[{beer_name:"Welcome to NextBeer, the intelligent beer discovery app!",beer_image_url:"./dist/img/beer.png"},{beer_name:"Swipe right on beers you like or want to try. Swipe left on the rest!",beer_image_url:"./dist/img/swipe-right.png"},{beer_name:"Click a beer to see its details , or navigate to My Beers in the side menu to see beers you liked.",beer_image_url:"./dist/img/tab.png"}],r=[{beer_id:104,beer_name:"Samuel Adams Boston Lager",beer_image_url:"./dist/img/samadams.jpg",beer_style:"dragon ball",beer_abv:"3"},{beer_id:754,beer_name:"Guinness Draught",beer_image_url:"./dist/img/guinness.jpg",beer_style:"dragon ball",beer_abv:"3"},{beer_id:355,beer_name:"Dead Guy Ale",beer_image_url:"./dist/img/deadguy.jpg",beer_style:"dragon ball",beer_abv:"3"},{beer_id:1904,beer_name:"Sierra Nevada Celebration Ale",beer_image_url:"./dist/img/sierranevada.jpg",beer_style:"dragon ball",beer_abv:"3"},{beer_id:680,beer_name:"Brooklyn Black Chocolate Stout",beer_image_url:"./dist/img/blackchocolate.jpg",beer_style:"dragon ball",beer_abv:"3"},{beer_id:1212,beer_name:"Blue Moon Belgian White",beer_image_url:"./dist/img/bluemoon.jpg",beer_style:"dragon ball",beer_abv:"3"}];angular.module("app.services",[]).factory("BeerFactory",["$http","$window","$q","$state","UtilFactory",function(n,o,a,s){var l=_.union(i,r),d=function(e){return n({method:"POST",url:t.baseUrl+"/rate",data:e})},c=function(e){l.push(e)},u=function(e){var t=JSON.parse(o.localStorage.getItem("myBeers"))||{};t[e.beer_name]=e,o.localStorage.setItem("myBeers",JSON.stringify(t))},h=function(){return JSON.parse(o.localStorage.getItem("myBeers"))},p=function(){return e},g=function(t){e=_.find(l,function(e){return e.beer_name===t}),s.go("app.detail")};return{beerRecQueue:l,addToQueue:c,addToMyBeers:u,getMyBeers:h,sendRating:d,getSelectedBeer:p,passSelectedBeer:g}}]).factory("UserFactory",["$http","$window","UtilFactory",function(e,i,r){var n=function(){return e({method:"POST",url:t.baseUrl+"/user"})},o=function(t){e.defaults.headers.common.Authorization=t},a=function(){i.localStorage.getItem("Token")?o(i.localStorage.getItem("Token")):n().then(function(e){i.localStorage.setItem("Token",e.data.token),o(e.data.token)}).catch(r.errorHandler)};return{enableToken:a}}]).factory("UtilFactory",[function(){var e=function(e){throw console.log("following error happened"),e};return{errorHandler:e}}])}(),function(e){for(var t=document.createElement("div"),i=["webkitTransformOrigin","transform-origin","-webkit-transform-origin","webkit-transform-origin","-moz-transform-origin","moz-transform-origin","MozTransformOrigin","mozTransformOrigin"],r="webkitTransformOrigin",n=0;n<i.length;n++)if(void 0!==t.style[i[n]]){r=i[n];break}for(var o=["webkitTransition","transition","-webkit-transition","webkit-transition","-moz-transition","moz-transition","MozTransition","mozTransition"],a="webkitTransition",n=0;n<o.length;n++)if(void 0!==t.style[o[n]]){a=o[n];break}var s=e.controllers.ViewController.inherit({initialize:function(e){this.cards=[];window.innerWidth/window.innerHeight;this.maxWidth=window.innerWidth-(e.cardGutterWidth||0),this.maxHeight=e.height||300,this.cardGutterWidth=e.cardGutterWidth||10,this.cardPopInDuration=e.cardPopInDuration||400,this.cardAnimation=e.cardAnimation||"pop-in"},pushCard:function(e){var t=this;this.cards.push(e),this.beforeCardShow(e),e.transitionIn(this.cardAnimation),setTimeout(function(){e.disableTransition(t.cardAnimation)},this.cardPopInDuration+100)},beforeCardShow:function(){var e=this.cards[this.cards.length-1];if(e){{window.innerHeight/2-this.maxHeight/2,5*Math.min(this.cards.length,3)}e.setPopInDuration(this.cardPopInDuration),e.setZIndex(this.cards.length)}},popCard:function(e){var t=this.cards.shift();return e&&t.swipe(),t}}),l=e.views.View.inherit({initialize:function(t){t=e.extend({},t),e.extend(this,t),this.el=t.el,this.startX=this.startY=this.x=this.y=0,this.bindEvents()},setX:function(t){this.el.style[e.CSS.TRANSFORM]="translate3d("+t+"px,"+this.y+"px, 0)",this.x=t,this.startX=t},setY:function(t){this.el.style[e.CSS.TRANSFORM]="translate3d("+this.x+"px,"+t+"px, 0)",this.y=t,this.startY=t},setZIndex:function(e){this.el.style.zIndex=e},setWidth:function(e){this.el.style.width=e+"px"},setHeight:function(e){this.el.style.height=e+"px"},setPopInDuration:function(e){this.cardPopInDuration=e},transitionIn:function(e){var t=this;this.el.classList.add(e+"-start"),this.el.classList.add(e),this.el.style.display="block",setTimeout(function(){t.el.classList.remove(e+"-start")},100)},disableTransition:function(e){this.el.classList.remove(e)},swipe:function(e){this.transitionOut(e)},transitionOut:function(t){var i=this;if(t===!0||this.x>0){var r=this.rotationAngle+.6*this.rotationDirection||Math.random()*-.4,n=this.rotationAngle?.2:.5;this.el.style[a]="-webkit-transform "+n+"s ease-in-out",this.el.style[e.CSS.TRANSFORM]="translate3d("+1.5*window.innerWidth+"px,"+this.y+"px, 0) rotate("+r+"rad)",this.onSwipe&&this.onSwipe(),i.positive=!0,setTimeout(function(){i.onDestroy&&i.onDestroy(!0)},1e3*n)}else{console.log(this.rotationAngle,"angle"),console.log(this.rotationDirection,"direction"),console.log(this.rotationAngle+.6*this.rotationDirection,"result");var r=-(this.rotationAngle+.6*this.rotationDirection)||.4*Math.random(),n=this.rotationAngle?.2:.5;this.el.style[a]="-webkit-transform "+n+"s ease-in-out",this.el.style[e.CSS.TRANSFORM]="translate3d("+-1.5*window.innerWidth+"px,"+this.y+"px, 0) rotate("+r+"rad)",this.onSwipe&&this.onSwipe(),i.positive=!1,setTimeout(function(){i.onDestroy&&i.onDestroy()},1e3*n)}},dragThreshold:0,bindEvents:function(){var t=this;e.onGesture("dragstart",function(e){var i=window.innerWidth/2;e.gesture.touches[0].pageX<i?t._transformOriginRight():t._transformOriginLeft(),window._rAF(function(){t._doDragStart(e)})},this.el),e.onGesture("drag",function(e){window._rAF(function(){t._doDrag(e)})},this.el),e.onGesture("dragend",function(e){window._rAF(function(){t._doDragEnd(e)})},this.el)},_transformOriginLeft:function(){this.el.style[r]="left center",this.rotationDirection=1},_transformOriginRight:function(){this.el.style[r]="right center",this.rotationDirection=-1},_doDragStart:function(e){var t=this.el.offsetWidth,i=window.innerWidth/2+this.rotationDirection*(t/2),r=Math.abs(i-e.gesture.touches[0].pageY);this.touchDistance=10*r},_doDrag:function(t){var i=t.gesture.deltaX/3;dragThreshold=Math.abs(i),this.rotationAngle=Math.atan(i/this.touchDistance)*this.rotationDirection,t.gesture.deltaX<0&&(this.rotationAngle=0),this.x=this.startX+.4*t.gesture.deltaX,this.el.style[e.CSS.TRANSFORM]="translate3d("+this.x+"px, "+this.y+"px, 0) rotate("+(this.rotationAngle||0)+"rad)"},_doDragEnd:function(t){dragThreshold>60?this.transitionOut(t):this.el.style[e.CSS.TRANSFORM]="translate3d("+this.startX+"px, "+this.startY+"px, 0) rotate(0rad)"}});angular.module("app.recommend.swipe",["ionic"]).directive("swipeCard",["$timeout",function(e){return{restrict:"E",template:'<div class="swipe-card" ng-transclude></div>',require:"^swipeCards",replace:!0,transclude:!0,scope:{onSwipe:"&",onDestroy:"&"},compile:function(){return function(t,i,r,n){var o=i[0],a=new l({el:o,onSwipe:function(){e(function(){t.onSwipe()})},onDestroy:function(){e(function(){t.onDestroy(),i.remove()})}});t.$parent.swipeCard=a,n.pushCard(a)}}}}]).directive("swipeCards",["$rootScope",function(e){return{restrict:"E",template:'<div class="swipe-cards" ng-transclude></div>',replace:!0,transclude:!0,scope:{},controller:function(){var t=new s({});return e.$on("swipeCard.pop",function(e){t.popCard(e)}),t}}}]).factory("$ionicSwipeCardDelegate",["$rootScope",function(e){return{popCard:function(t,i){e.$emit("swipeCard.pop",i)},getSwipebleCard:function(e){return e.$parent.swipeCard}}}])}(window.ionic);